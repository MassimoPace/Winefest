<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Secret Draw — Country & Style</title>
<style>
body { font-family: sans-serif; background:#121212; color:#fff; display:flex; justify-content:center; align-items:center; min-height:100vh; padding:20px; }
.card { background:#1e1e2f; padding:20px; border-radius:12px; width:100%; max-width:600px; }
textarea, input { width:100%; padding:10px; margin:6px 0; border-radius:8px; border:1px solid #333; background:#111; color:#fff; }
button { padding:10px 16px; margin:6px 2px; border:none; border-radius:8px; cursor:pointer; }
.hidden { display:none; }
.link-item { display:flex; justify-content:space-between; background:#222; padding:8px; border-radius:6px; margin:4px 0; }
</style>
</head>
<body>
<div class="card" id="setup">
  <h2>Secret Draw — Country & Style</h2>
  <label>Countries (one per line)</label>
  <textarea id="countriesInput" placeholder="Japan&#10;Italy&#10;Brazil"></textarea>
  <label>Styles (one per line)</label>
  <textarea id="stylesInput" placeholder="Minimalist&#10;Baroque&#10;Futuristic"></textarea>
  <button id="genBtn">Generate draw links</button>
</div>

<div class="card hidden" id="links">
  <h2>Draw Links</h2>
  <div id="linksList"></div>
  <button id="backBtn">Back</button>
  <button id="copyAllBtn">Copy All</button>
</div>

<div class="card hidden" id="draw">
  <h2 id="drawMsg"></h2>
  <div id="countdown">3</div>
  <button id="revealBtn">Reveal my draw</button>
  <div id="result"></div>
  <button id="copyResultBtn">Copy result</button>
  <audio id="suspenseAudio" src="https://cdn.pixabay.com/download/audio/2022/02/15/audio_678f82049d.mp3?filename=suspense-ambient-112.mp3" preload="auto"></audio>
</div>

<script>
document.addEventListener('DOMContentLoaded', ()=>{
const $ = s=>document.querySelector(s);
const toLines = s=>s.split(/\r?\n/).map(x=>x.trim()).filter(Boolean);

function shuffleArray(arr){
  for(let i=arr.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]]=[arr[j],arr[i]];
  }
  return arr;
}

const genBtn=$('#genBtn'), backBtn=$('#backBtn'), copyAllBtn=$('#copyAllBtn');
const setup=$('#setup'), links=$('#links'), linksList=$('#linksList');
const draw=$('#draw'), drawMsg=$('#drawMsg'), countdown=$('#countdown'), revealBtn=$('#revealBtn'), result=$('#result'), copyResultBtn=$('#copyResultBtn'), suspense=$('#suspenseAudio');

genBtn.onclick = ()=>{
  const countries = toLines($('#countriesInput').value);
  const styles = toLines($('#stylesInput').value);
  if(countries.length !== styles.length || countries.length===0){alert('Lists must have same length'); return;}
  let pairs = countries.map((c,i)=>({country:c, style:styles[i]}));
  shuffleArray(pairs);
  linksList.innerHTML='';
  pairs.forEach((p,i)=>{
    const frag = encodeURIComponent(JSON.stringify({country:p.country, style:p.style}));
    const url = location.origin + location.pathname + '#' + frag;
    const div = document.createElement('div'); div.className='link-item';
    const span = document.createElement('span'); span.textContent=`Link ${i+1}`;
    const a = document.createElement('a'); a.href=url; a.target='_blank'; a.textContent='Open';
    const btn = document.createElement('button'); btn.textContent='Copy'; btn.onclick=()=>navigator.clipboard.writeText(url);
    div.append(span, btn, a); linksList.appendChild(div);
  });
  setup.classList.add('hidden'); links.classList.remove('hidden');
};

backBtn.onclick = ()=>{links.classList.add('hidden'); setup.classList.remove('hidden');};

function initDraw(){
  if(!location.hash) return;
  try{
    const data=JSON.parse(decodeURIComponent(location.hash.slice(1)));
    setup.classList.add('hidden'); links.classList.add('hidden'); draw.classList.remove('hidden');
    drawMsg.textContent='Your draw is ready!';
    countdown.classList.add('hidden');
    revealBtn.onclick=()=>{
      revealBtn.disabled=true;
      countdown.classList.remove('hidden'); countdown.textContent='3';
      suspense.play().catch(()=>{});
      let count=3;
      const interval=setInterval(()=>{
        count--;
        if(count>0) countdown.textContent=count;
        else{
          clearInterval(interval); countdown.classList.add('hidden');
          result.textContent=`${data.country} — ${data.style}`;
          copyResultBtn.onclick=()=>navigator.clipboard.writeText(`${data.country} — ${data.style}`);
          result.classList.remove('hidden'); copyResultBtn.classList.remove('hidden');
        }
      },1000);
    };
  }catch(e){console.log(e);}
}
initDraw();
});
</script>
</body>
</html>
